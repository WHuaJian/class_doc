## SUID功能

- 只有可以执行的二进制程序才能设定SUID权限
- 命令执行者要对该程序拥有x权限。如果没有x权限显示权限时会显示大写S，代表拥有SUID权限但没有x权限
- 命令执行者在执行程序时获得该程序文件属主的身份(例如原本文件的属于root，你是一个普通用户，在你执行文件的过程中文件暂时属于你，类似于灵魂附体)
- SetUID权限只在该程序执行过程中有效，也就是说身份改变只在程序执行过程中有效

例如：

![image-20200929091618959](E:\Code\LearnDemo\学习文档\运维\Linux\images\image-20200929091618959.png)

> 以passwd文件为例，普通用户可以修改自己的密码，所以在前面存在一个s代表SUID权限,这是所有者。执行时获得文件所有者的权限可以对进行任何操作
>
> 后面的SGID对应所属组的这一特殊权限
>
> StickyBit对应其他人的这一特殊权限
>
> #### 其实SUID,GUID,StickyBit分别对应所有者，所属组，其他人这三大权限的扩展

![image-20200929092221832](.\images\image-20200929092221832.png)

### 设定SetUID的方法

4代表SUID

- chmod 4755 文件名   755是之前所有者，所属组，其他人的权限。4代表赋予SUID

> chmod 755 文件名  取消赋予权限

- chmod u+s 文件名    直接让u赋予SUID的权限

> chmod u-s 文件名  取消赋予权限

> 4：代表所属用户权限  2：代表所属组权限  1：代表其他人权限
>
> 即：4755开启SUID权限，2755开启GUID权限，1开启StickyBit权限。7代表开启所有特殊权限(一般不会用到)



### SUID危险性

由于SUID能让普通用户在执行程序时升级为管理员，很容易成为黑客攻击的方式。

例如：给与vim编译器SUID的权限。当黑客以普通用户登陆时，使用vim打开passwd文件。由于已经赋予了SUID权限，所以此时黑客在使用vim编辑时获取了root权限，可以随意修改，比如将自己的用户权限改为root。这样是非常危险的做法。

#### 所以使用SUID的注意点

- 关键目录应严格控制写权限。比如“/”,"/usr"等
- 用户的密码设置要严格遵守密码三原则(复杂性,易记性,定期更改)
- 对系统中默认应该具有SetUID权限的文件作一列表，定时检查有没有除此以外的文件被设置了SUID权限



## SGID功能

同SUID的功能

![image-20200929095443257](.\images\image-20200929095443257.png)

> 一般用户对mlocate.db没有操作权限，而locate拥有SGID权限。
>
> 当执行locate命令时用户升级为locate所属组，而该组拥有对mlocate.db的r权限，所有就可以进行搜索
>
> 原来组的x权限的地方变成了s



#### 设定SetGID的方法

- chmod 2755 文件名/目录

- chmod g+s 文件名/目录    直接让g赋予SGID的权限



#### SGID对于目录

- 普通用户必须对目录拥有r和x权限，才能进入目录
- 普通用户在此目录中的有效组会变成此目录的所属组
- 若普通用户对此目录拥有w权限时，新建的文件默认所属组是该目录的所属组而不是用户的所属组

> SGID相比SUID安全很多



## Sticky BIT功能(粘着位)

- 粘着位目前只对**目录**有效
- 普通用户对该目录拥有w和x权限，即普通用户可以在此目录拥有写入权限
- 如果没有粘着位，因为普通用户拥有w权限，所以可以删除此目录下所有文件，包括其他用户建立的文件。一但赋予粘着位，除了root可以删除所有文件，普通用户就算拥有w权限，也只能删除自己建立的文件，但不能删除其他用户建立的文件

> 为了保护那些建立在别人创建的目录中的文件。作为目录的创建者不能去删除别人创建的文件



![image-20200929102043152](.\images\image-20200929102043152.png)

> x权限变成了t



#### 设定粘着位的方法

- chmod 1755 目录

- chmod o+t  目录



# chattr权限

> 改变文件系统属性权限
>
> 对于重要的文件夹，可以防止用户误操作

#### 命令格式：chattr [+-=] [参数] 文件/目录

#### 参数：

- -i

> 如果对文件设置i属性，那么不允许对文件进行，删除，改名，也不能添加和修改数据。如果对目录设置i属性，那么只能修改目录下文件的数据，但不允许建立和删除文件
>
> 相当于把文件/文件夹锁定了

- -a

> 如果对文件设计a属性，那么只能在文件中增加数据，但是不能删除也不能修改数据，如果对目录设置a属性，那么只允许在目录中建立和修改文件，但不允许删除

该命令解决了粘着位不对root用户生效的问题，设置后root也要遵守上面的规则

> 示例：`chattr +i /test`



#### 查看文件系统属性

#### 命令格式：lsattr [参数] 文件名

#### 参数：

- -a：显示所有文件和目录
- -d：若目标是目录，仅列出目录本身的属性，而是不hi子文件的



# sudo权限

> 用于操作系统命令
>
> 把root本来只能用超级用户执行的命令赋予普通用户执行

需要通过visudo来赋予普通用户哪些命令可以使用sudo执行

> 实际修改`/etc/sudoers`文件



修改还是比较复杂的，而且一般很少用，这边不展开了