# 分区类型

- 主分区

> 总共最多只能分四个

- 扩展分区

> 只能有一个，也算作主分区的一种，也就是说主分区加扩展分区最多有四个。但是扩展分区不能存储数据和格式化，必须再划分成逻辑分区才能使用
>
> 主要作用是破解主分区只有四个的问题。内部用来装载多个逻辑分区

- 逻辑分区

> 逻辑分区是在扩展分区中划分的，如果是IDE硬盘，linux最多支持59个逻辑分区，如果是SCSI硬盘linux最多支持11个逻辑分区

![image-20200929111132219](.\images\image-20200929111132219.png)![image-20200929111155698](.\images\image-20200929111155698.png)

![image-20200929111312257](E:\Code\LearnDemo\学习文档\运维\Linux\images\image-20200929111312257.png)![image-20200929111331036](.\images\image-20200929111331036.png)

> 不管主分区怎么分，逻辑分区总从5开始



# 文件系统

- ext2

> ext文件系统的升级版本。最大支持16TB的分区和最大2TB的文件

- ext3

> ext2的升级版。添加了日志系统，以提高系统突然停止时提高文件系统的可靠性

- ext4

> ext3的升级版。在性能，伸缩性，可靠性方面有了大量改进。可以说是天翻地覆的
>
> 兼容ext3，最大支持1EB文件系统和16TB文件
>
> 无限数量子目录，extents连续数据库概念，多块分配，延迟分配，持久预分配，快速FSCK，日志校验，无日志模式，在线碎片整理，inode增强，默认启动barrier等
>
> centos 6.3开始默认文件系统



# 文件系统常用命令

### `df`

#### 功能：查看文件系统

#### 格式：df [参数] [挂载点]

#### 参数：

- -a：显示所有的文件系统信息，包括特殊文件系统
- -h：使用习惯单位显示容量，如KB,MB,GB等
- -T：显示文件系统类型
- -m：以MB为单位显示容量
- -k：以KB为单位显示容量

> 示例：
>
> - df      显示所有分区
> - df -h  人性化显示所有分区           



### `du`

#### 功能：查看目录下所有的文件占用的空间和总大小

#### 格式：du 目录

> ls -l 只能统计目录下一级的文件/指针大小，并不是总体大小

#### 参数：

- -T：显示文件系统类型

> 由于要扫描整个目录，所以需要占用一定的系统资源



### du命令和`df`命令的区别

> 两者都能统计文件系统大小，但会有不同

- df从文件系统角度出发，不光要考虑文件占用的空间，还要统计被命令或程序占用的空间(如文件已经删除，但程序并没有释放空间)

- du面向文件，只会计算文件或目录占用的空间

> 所以df统计的空间才是真正的可用空间是真正的可用空间

> 由于删除文件后linux在重启后才会释放空间，所以对于一些高频使用的服务器如游戏服务器，最好每周重启一次。
>
> 这就是为什么游戏会有定期的维护，主要工作就是重启



### `fsck`

#### 功能：文件系统修复功能

#### 格式：`fsck` [选项] 分区设备文件名

#### 参数：

- -a：不用显示用户提示，自动修复文件系统
- -y：自动修复。和-a一致，只不过有些文件系统只支持-y

> 不要随便执行，容易把系统搞崩溃



### `dumpe2fs`

#### 功能：显示磁盘状态命令

#### 格式：dumpe2fs 分区设备文件名

> 示例：dumpe2fs /dev/sda1



##### 这边补充一个知识：把文件系统类比为储物柜。分区是把大柜子打成小柜子，格式化就是把小柜子打成隔断。一个隔断的大小就是一个Block Size(默认4KB)。当一个10KB的文件存储时就使用了3个“隔断”进行存储



# 挂载命令

#### 查询挂载

#### 格式：mount [参数]

#### 参数：

- -l：查询系统中已经挂载的设备，-l会显示卷标名称



#### 自动挂载

#### 格式：mount -a

> 依据配置文件`/etc/fstab`的内容，自动挂载

> 光盘，移动硬盘，软盘这样的移动介质不能写入，因为不能保证每次开机就有



#### 挂载命令格式：mount [-t 文件系统] [-L 卷标名] [-o 特殊参数] 设备文件名 挂载点

#### 参数：

- -t：加入文件系统类型来指定挂载的类型，可以是ext3，ext4，iso9660等文件系统
- -L：挂载指定卷标的分区，而不是安装设备文件名挂载
- -o：可以指定挂载的额外选项

#### 特殊参数

![image-20200929131005459](.\images\image-20200929131005459.png)

> 内容过于复杂，这边只是列举了命令



### 挂载光盘过程示例

```
1.mkdir /mnt/cdrom/   #建立挂载点
2.mount -t ios9660 /dev/cdreom /mnt/cdrom/   #挂载光盘
3.umount  /mnt/cdrom/   #卸载挂载点
```

### 挂载U盘示例

```
1.fdisk -l          #查看U盘设备文件名
2.mount -t vfat /dev/sdb1 /mnt/usb/
```

> `linux`默认不支持NTFS文件系统,所以会看不到。需要通过配置来使其支持	



### `fdisk`

#### 查询挂载

#### 格式：`fdisk -l`

#### 参数：

- -l：查询系统中已经挂载的设备，-l会显示卷标名称



#### 命令分区

#### 格式：`fdisk 分区名`

> 示例：`fdisk /dev/sdb`  一般都是针对新硬盘分区，所以后面没有数字
>
> 输入后会进去一个命令交互界面，其命令如下

![image-20200929135059910](.\images\image-20200929135059910.png)



#### 重新读取分区表命令

#### 命令格式：`partprobe`

> 当执行完上面的分区命令后，一般要重启Linux才生效，这里可以让你不重启也能生效



#### 格式化分区

#### 命令格式：`mkfs -t ext4 /dev/sdb1`

> 结束后需要将硬盘挂载到目录，操作和挂载U盘一致。但重启后挂载会消失，需要进行自动挂载



## 自动挂载

![image-20200929140250593](.\images\image-20200929140250593.png)![image-20200929140340385](.\images\image-20200929140340385.png)

> 你把需要挂载设备加一个信息在这个文件下就会实现自动挂载

> 修改完需要执行`mount -a` 让系统重新挂载一遍分区，这样有错误会显示出来



`/etc/fstab`文件修复

在系统启动时会显示错误，但可以进入系统。不过此时`fstab`文件是只读的不能修改，需要执行下面的命令将其改为可读写的

> `mount -o remount,rw /` 
>
> 然后再根据提示修改文件，修复错误

centos7以后这个问题不存在了，系统会正常启动并且可以正常修改文件



